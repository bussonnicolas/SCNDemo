/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.commons.RoadMapRenderer");(function(){sap.ui.commons.RoadMapRenderer={};sap.ui.commons.RoadMapRenderer.render=function(R,j){var l=R;j.doBeforeRendering();if(!j.getVisible()){return}l.write("<div");l.writeControlData(j);l.addClass("sapUiRoadMap");l.writeClasses();l.writeAttribute("tabIndex","0");var t=j.getTooltip_AsString();if(t){l.writeAttributeEscaped("title",t)}l.writeAttribute("style","width:"+(j.getWidth()?j.getWidth():"100%")+";");l.write(">");r(l,j,true);l.write("<ul");l.writeAttribute("id",j.getId()+"-steparea");l.addClass("sapUiRoadMapStepArea");l.writeClasses();if(sap.ui.getCore().getConfiguration().getAccessibility()){l.writeAttribute("role","group");l.writeAttribute("aria-label",e("RDMP_DEFAULT_TOOLTIP",[]));if(t){l.writeAttributeEscaped("title",t)}}l.write(">");var s=j.getSteps();for(var i=0;i<s.length;i++){var S=s[i];if(S.getSubSteps().length>0){c(l,j,S)}else{a(l,j,S)}}l.write("</ul>");r(l,j,false);l.write("</div>")};sap.ui.commons.RoadMapRenderer.selectStepWithId=function(R,i){var C=R.getSelectedStep();if(C){jQuery.sap.byId(C).removeClass("sapUiRoadMapSelected")}if(i){jQuery.sap.byId(i).addClass("sapUiRoadMapSelected")}if(sap.ui.getCore().getConfiguration().getAccessibility()){if(C){jQuery.sap.byId(C+"-box").removeAttr("aria-checked")}if(i){jQuery.sap.byId(i+"-box").attr("aria-checked",true)}}};sap.ui.commons.RoadMapRenderer.selectStep=function(R,s,I,S,E,j){if(!j){sap.ui.commons.RoadMapRenderer.selectStepWithId(R,s.getId())}if(!I&&s.getSubSteps().length>0){var l=s.getSubSteps();var D=jQuery.sap.byId(s.getId());var p=D.hasClass("sapUiRoadMapExpanded");var C=1;var q=function(){C--;if(C>0){return}if(E){E(!p?"expanded":"collapsed")}sap.ui.commons.RoadMapRenderer.updateStepArea(R)};var A=function(v,O,x){var y=jQuery.sap.byId(v);if(!jQuery.fx.off&&!S){y.width(O?"0px":R.iStepWidth);var L=jQuery.sap.byId(v+"-label");L.addClass("sapUiRoadMapHidden");if(O){y.toggleClass("sapUiRoadMapHidden")}y.animate({width:O?R.iStepWidth:"0px"},"fast",function(){if(!O){y.toggleClass("sapUiRoadMapHidden")}y.width("");L.removeClass("sapUiRoadMapHidden");if(x){x()}})}else{y.toggleClass("sapUiRoadMapHidden");if(x){x()}}};D.toggleClass("sapUiRoadMapExpanded");if(sap.ui.getCore().getConfiguration().getAccessibility()){var t=D.hasClass("sapUiRoadMapExpanded");jQuery.sap.byId(s.getId()+"-box").attr("aria-expanded",t);jQuery.sap.byId(s.getId()+"-expandend-box").attr("aria-expanded",t)}for(var i=0;i<l.length;i++){if(l[i].getVisible()){C++;A(l[i].getId(),!p,q)}}A(s.getId()+"-expandend",!p,q)}else{if(E){E("selected")}}};sap.ui.commons.RoadMapRenderer.updateStepArea=function(R){if(R.iStepWidth!=-1){var s=jQuery.sap.byId(R.getId()+"-steparea");var S=jQuery.sap.byId(R.getId()+"-Start");var E=jQuery.sap.byId(R.getId()+"-End");var j=jQuery.sap.byId(R.getId());var i=s.scrollLeft();var A=j.width()-S.outerWidth(true)-E.outerWidth(true);var M=R.getNumberOfVisibleSteps();var C=f(R);if(M<1){M=C}else{M=Math.min(M,C)}var p=Math.floor(A/R.iStepWidth);var N=Math.min(M,p);s.width(N*R.iStepWidth).scrollLeft(i);u(R)}};sap.ui.commons.RoadMapRenderer.updateScrollArea=function(R,s){sap.ui.commons.RoadMapRenderer.updateStepArea(R);if(!s){var S=jQuery.sap.byId(R.getId()+"-steparea");var p=n(R,false);if(R.getFirstVisibleStep()){var j=jQuery.sap.byId(R.getFirstVisibleStep());p=h(S,j)}o(R,p+k()*S.scrollLeft(),true)}};sap.ui.commons.RoadMapRenderer.isVisibleRef=function(R,I){var s=jQuery.sap.byId(R.getId()+"-steparea");var S=s.children(":visible");for(var i=0;i<S.length;i++){var C=jQuery(S.get(i));if(C.attr("id")==I){var p=h(s,C);return p>=0&&p<s.width()}}return false};sap.ui.commons.RoadMapRenderer.getFirstVisibleRef=function(R){var s=jQuery.sap.byId(R.getId()+"-steparea");var S=s.children(":visible");for(var i=0;i<S.length;i++){var C=jQuery(S.get(i));if(h(s,C)==0){return C}}return null};sap.ui.commons.RoadMapRenderer.setStepLabel=function(s,L){var l=L?jQuery.sap.escapeHTML(L):"";jQuery.sap.byId(s.getId()+"-label").html(l);jQuery.sap.byId(s.getId()+"-expandend-label").html(l)};sap.ui.commons.RoadMapRenderer.setStepEnabled=function(R,s,E){var j=jQuery.sap.byId(s.getId());var i=jQuery.sap.byId(s.getId()+"-expandend");if(E){j.removeClass("sapUiRoadMapDisabled");i.removeClass("sapUiRoadMapDisabled");if(sap.ui.getCore().getConfiguration().getAccessibility()){jQuery.sap.byId(s.getId()+"-box").removeAttr("aria-disabled");jQuery.sap.byId(s.getId()+"-expandend-box").removeAttr("aria-disabled")}return false}else{var S=R.getSelectedStep()==s.getId();if(S){j.removeClass("sapUiRoadMapSelected")}j.addClass("sapUiRoadMapDisabled");i.addClass("sapUiRoadMapDisabled");if(sap.ui.getCore().getConfiguration().getAccessibility()){var l=jQuery.sap.byId(s.getId()+"-box");l.attr("aria-disabled",true);if(S){l.removeAttr("aria-checked")}jQuery.sap.byId(s.getId()+"-expandend-box").attr("aria-disabled",true)}return S}};sap.ui.commons.RoadMapRenderer.setStepVisible=function(R,s,I,v){var j=jQuery.sap.byId(s.getId());var l=jQuery.sap.byId(s.getId()+"-expandend");var S=R.getSelectedStep()==s.getId();var p=s.getParent();if(I){if(p.getEnabled()&&p.getVisible()&&p.getExpanded()){if(v){j.removeClass("sapUiRoadMapHidden")}else{j.addClass("sapUiRoadMapHidden")}}}else{if(v){j.removeClass("sapUiRoadMapHidden")}else{j.addClass("sapUiRoadMapHidden")}var q=s.getSubSteps();if(q.length>0&&s.getExpanded()){if(v){l.removeClass("sapUiRoadMapHidden")}else{l.addClass("sapUiRoadMapHidden")}for(var i=0;i<q.length;i++){if(q[i].getVisible()){var t=jQuery.sap.byId(q[i].getId());if(R.getSelectedStep()==q[i].getId()){S=true;t.removeClass("sapUiRoadMapSelected");jQuery.sap.byId(q[i].getId()+"-box").removeAttr("aria-checked")}if(v){t.removeClass("sapUiRoadMapHidden")}else{t.addClass("sapUiRoadMapHidden")}}}}}return S};sap.ui.commons.RoadMapRenderer.setRoadMapWidth=function(R,W){var j=jQuery.sap.byId(R.getId());j.attr("style","width:"+(W?W:"100%")+";")};sap.ui.commons.RoadMapRenderer.scrollToNextStep=function(R,D,E){var p=D;if(D=="first"||D=="last"){p=n(R,D=="last")}o(R,p,false,E)};sap.ui.commons.RoadMapRenderer.addEllipses=function(s){if(!s){return}var S=jQuery.sap.byId(s.getId()+"-label");var O=jQuery.sap.escapeHTML(s.getLabel());var t=O+"";var C=jQuery("<label class=\"sapUiRoadMapTitle\" style=\"display:none;position:absolute;overflow:visible;font-weight:bold;height:auto\">"+t+"</label>");C.width(S.width());jQuery(sap.ui.getCore().getStaticAreaRef()).append(C);var i=false;while(t.length>0&&C.height()>S.height()){t=t.substr(0,t.length-1);C.html(t+"...");i=true}if(i){var H=C.html();H=H.substr(0,H.length-3);H=jQuery.sap.escapeHTML(H);H="<span>"+H+"</span>";S.html(H);if(sap.ui.getCore().getConfiguration().getAccessibility()){S.attr("aria-label",s.getLabel())}S.attr("title",s.getLabel())}else{S.removeAttr("aria-label");S.attr("title",g(s))}C.remove()};var r=function(i,R,s){var t=s?"Start":"End";i.write("<div");i.writeAttribute("id",R.getId()+"-"+t);i.writeAttribute("tabindex","-1");var j=true;i.addClass(j?"sapUiRoadMap"+t+"Scroll":"sapUiRoadMap"+t+"Fixed");i.addClass("sapUiRoadMapDelim");i.addClass("sapUiRoadMapContent");i.writeClasses();i.write("></div>")};var a=function(j,R,s,A,l,I){j.write("<li");if(I){j.writeAttribute("id",I)}else{j.writeElementData(s)}var S=d(R,s);s.__stepName=S;var t=g(s);j.addClass("sapUiRoadMapContent");j.addClass("sapUiRoadMapStep");if(!s.getVisible()){j.addClass("sapUiRoadMapHidden")}if(s.getEnabled()){if(R.getSelectedStep()==s.getId()){j.addClass("sapUiRoadMapSelected")}}else{j.addClass("sapUiRoadMapDisabled")}if(A){for(var i=0;i<A.length;i++){j.addClass(A[i])}}j.writeClasses();j.write(">");b(j,I?I:s.getId(),1);j.write("<div");j.writeAttribute("id",(I?I:s.getId())+"-box");j.writeAttribute("tabindex","-1");j.addClass("sapUiRoadMapStepBox");j.writeClasses();j.writeAttributeEscaped("title",t);w(j,R,s,l?true:false);j.write("><span>");j.write(S);j.write("</span>");if(l){l(j,R,s)}j.write("</div>");j.write("<label");j.writeAttribute("id",(I?I:s.getId())+"-label");j.writeAttribute("for",(I?I:s.getId())+"-box");j.addClass("sapUiRoadMapTitle");j.writeAttributeEscaped("title",t);j.writeClasses();j.write(">");var L=s.getLabel();if(L){j.writeEscaped(L)}j.write("</label>");b(j,I?I:s.getId(),2);j.write("</li>")};var g=function(s){var t=s.getTooltip_AsString();if(!t){if(sap.ui.getCore().getConfiguration().getAccessibility()){t=e("RDMP_DEFAULT_STEP_TOOLTIP",[s.__stepName])}else{t=""}}return t};var b=function(i,I,j){i.write("<div");i.writeAttribute("id",I+"-add"+j);i.addClass("sapUiRoadMapStepAdd"+j);i.writeClasses();i.write("></div>")};var w=function(i,R,s,I){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return}i.writeAttribute("role","treeitem");if(s.getEnabled()){i.writeAttribute("aria-checked",R.getSelectedStep()==s.getId())}else{i.writeAttribute("aria-disabled",true)}i.writeAttribute("aria-haspopup",I);i.writeAttribute("aria-level",s.getParent()instanceof sap.ui.commons.RoadMap?1:2);if(!I){return}i.writeAttribute("aria-expanded",s.getExpanded())};var c=function(j,R,s){var C=function(j,R,p,q,A){j.write("<div");j.writeAttribute("id",p+"-ico");j.addClass("sapUiRoadMapStepIco");if(A){j.addClass(A)}j.writeClasses();j.write("></div>")};var I=s.getExpanded();a(j,R,s,I?["sapUiRoadMapExpanded"]:null,function(j,R,s){C(j,R,s.getId(),I?"roundtripstart.gif":"roundtrip.gif")});var S=s.getSubSteps();for(var i=0;i<S.length;i++){var l=["sapUiRoadMapSubStep"];if(!I&&S[i].getVisible()){l.push("sapUiRoadMapHidden")}a(j,R,S[i],l)}l=["sapUiRoadMapExpanded","sapUiRoadMapStepEnd"];if(!I){l.push("sapUiRoadMapHidden")}a(j,R,s,l,function(j,R,s){C(j,R,s.getId()+"-expandend","roundtripend.gif")},s.getId()+"-expandend")};var d=function(R,s){var p=s.getParent();if(p===R){return p.indexOfStep(s)+1}var i=p.indexOfSubStep(s);if(i<26){return String.fromCharCode(97+i)}var j=Math.floor(i/26)-1;var l=i%26;return String.fromCharCode(97+j,97+l)};var u=function(R){var i=k();var s=jQuery.sap.byId(R.getId()+"-steparea");var S=m(s);var j=jQuery.sap.byId(R.getId()+"-Start");j.removeClass("sapUiRoadMapStartScroll").removeClass("sapUiRoadMapStartFixed");j.addClass(i*S>=R.iStepWidth?"sapUiRoadMapStartScroll":"sapUiRoadMapStartFixed");var E=jQuery.sap.byId(R.getId()+"-End");E.removeClass("sapUiRoadMapEndScroll").removeClass("sapUiRoadMapEndFixed");var l=s.get(0).scrollWidth-i*S-s.width()<R.iStepWidth;E.addClass(l?"sapUiRoadMapEndFixed":"sapUiRoadMapEndScroll")};var e=function(K,A){var i=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons");if(i){return i.getText(K,A)}return K};var f=function(R){var l=0;var s=R.getSteps();for(var i=0;i<s.length;i++){if(s[i].getVisible()){l++;if(s[i].getExpanded()){l++;var S=s[i].getSubSteps();for(var j=0;j<S.length;j++){if(S[j].getVisible()){l++}}}}}return l};var h=function(s,S){var p=S.position().left;if(sap.ui.getCore().getConfiguration().getRTL()){p=s.width()-p-S.outerWidth()}return p};var k=function(){return sap.ui.getCore().getConfiguration().getRTL()&&!jQuery.browser.msie?-1:1};var m=function(s){if(sap.ui.getCore().getConfiguration().getRTL()&&jQuery.browser.webkit){return(-1)*(s.get(0).scrollWidth-s.scrollLeft()-s.width())}return s.scrollLeft()};var n=function(R,l){var s=jQuery.sap.byId(R.getId()+"-steparea").get(0).scrollWidth;if(sap.ui.getCore().getConfiguration().getRTL()&&jQuery.browser.webkit){return l?0:(-1)*s}return l?s:0};var o=function(R,N,s,E){var S=jQuery.sap.byId(R.getId()+"-steparea");S.stop(false,true);if(N=="next"){N=S.scrollLeft()+R.iStepWidth*k()}else if(N=="prev"){N=S.scrollLeft()-R.iStepWidth*k()}else if(N=="keep"){N=S.scrollLeft()}else{N=N*k()}var D=function(){u(R);if(E){var F=sap.ui.commons.RoadMapRenderer.getFirstVisibleRef(R);E(F.attr("id"))}};if(!jQuery.fx.off&&!s){S.animate({scrollLeft:N},"fast",D)}else{S.scrollLeft(N);D()}}}());
